<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCMS Helpdesk FAQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .collapsible-content { 
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.active {
            max-height: 10000px;
            transition: max-height 0.5s ease-in;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <div class="max-w-5xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-8 mb-6">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h1 id="page-title" class="text-3xl font-bold text-indigo-900 mb-2">CCMS Helpdesk FAQ</h1>
                    <p id="page-subtitle" class="text-gray-600">Cloud Clinic Management system</p>
                </div>
            </div>

            <!-- Search Box -->
            <div class="relative mt-6">
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search questions and answers..."
                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                />
            </div>
        </div>

        <!-- FAQ Sections Container -->
        <div id="faq-container"></div>

        <!-- No Results Message -->
        <div id="no-results" class="bg-white rounded-lg shadow-md p-8 text-center text-gray-500 hidden">
            No FAQs found matching your search.
        </div>

        <!-- Footer -->
        <div class="mt-8 text-center text-gray-600 text-sm">
            <p>For additional assistance, contact local admin or inquire in CCMS Helpdesk Group</p>
        </div>
    </div>

    <script>
        let faqData = null;
        let expandedSections = {};
        let expandedQuestions = {};

        // Load FAQ data from JSON file
        async function loadFaqData() {
            try {
                const response = await fetch('faq-data.json');
                faqData = await response.json();
                
                // Set title and subtitle
                document.getElementById('page-title').textContent = faqData.title;
                document.getElementById('page-subtitle').textContent = faqData.subtitle;
                
                // Initialize all sections as expanded
                faqData.sections.forEach(section => {
                    expandedSections[section.id] = true;
                });
                
                renderFaqs();
            } catch (error) {
                console.error('Error loading FAQ data:', error);
                document.getElementById('faq-container').innerHTML = 
                    '<div class="bg-white rounded-lg shadow-md p-8 text-center text-red-500">Error loading FAQ data. Please ensure faq-data.json exists.</div>';
            }
        }

        // Filter FAQs based on search term
        function filterFaqs(searchTerm) {
            if (!searchTerm.trim()) return faqData.sections;
            
            const term = searchTerm.toLowerCase();
            return faqData.sections.map(section => ({
                ...section,
                questions: section.questions.filter(q => {
                    const questionMatch = q.question.toLowerCase().includes(term);
                    const stepsMatch = q.steps && q.steps.some(step => 
                        step.text.toLowerCase().includes(term)
                    );
                    return questionMatch || stepsMatch;
                })
            })).filter(section => section.questions.length > 0);
        }

        // Toggle section expand/collapse
        function toggleSection(sectionId) {
            expandedSections[sectionId] = !expandedSections[sectionId];
            const content = document.getElementById(`section-content-${sectionId}`);
            const icon = document.getElementById(`section-icon-${sectionId}`);
            
            if (expandedSections[sectionId]) {
                content.classList.add('active');
                icon.innerHTML = '<polyline points="18 15 12 9 6 15"></polyline>';
            } else {
                content.classList.remove('active');
                icon.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
            }
        }

        // Toggle question expand/collapse
        function toggleQuestion(questionId) {
            expandedQuestions[questionId] = !expandedQuestions[questionId];
            const content = document.getElementById(`question-content-${questionId}`);
            const icon = document.getElementById(`question-icon-${questionId}`);
            
            if (expandedQuestions[questionId]) {
                content.classList.add('active');
                icon.innerHTML = '<polyline points="18 15 12 9 6 15"></polyline>';
            } else {
                content.classList.remove('active');
                icon.innerHTML = '<polyline points="6 9 12 15 18 9"></polyline>';
            }
        }

        // Render FAQs
        function renderFaqs(searchTerm = '') {
            const filteredSections = filterFaqs(searchTerm);
            const container = document.getElementById('faq-container');
            const noResults = document.getElementById('no-results');
            
            if (filteredSections.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            container.innerHTML = filteredSections.map((section, sIdx) => `
                <div class="bg-white rounded-lg shadow-md mb-4">
                    <!-- Section Header -->
                    <button onclick="toggleSection('${section.id}')" class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors">
                        <h2 class="text-xl font-semibold text-indigo-800">
                            ${sIdx + 1}. ${section.title}
                        </h2>
                        <svg id="section-icon-${section.id}" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-600">
                            <polyline points="18 15 12 9 6 15"></polyline>
                        </svg>
                    </button>
                    
                    <!-- Questions -->
                    <div id="section-content-${section.id}" class="collapsible-content ${expandedSections[section.id] ? 'active' : ''} border-t border-gray-200">
                        ${section.questions.map((q, qIdx) => `
                            <div class="border-b border-gray-100 last:border-b-0">
                                <button onclick="toggleQuestion('${q.id}')" class="w-full px-6 py-4 text-left hover:bg-gray-50 transition-colors">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <span class="inline-block bg-indigo-100 text-indigo-700 text-sm font-semibold px-2 py-1 rounded mr-3">
                                                ${sIdx + 1}.${qIdx + 1}
                                            </span>
                                            <span class="text-gray-800 font-medium">
                                                ${q.question}
                                            </span>
                                        </div>
                                        <svg id="question-icon-${q.id}" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 flex-shrink-0 ml-2">
                                            <polyline points="6 9 12 15 18 9"></polyline>
                                        </svg>
                                    </div>
                                </button>
                                
                                <div id="question-content-${q.id}" class="collapsible-content ${expandedQuestions[q.id] ? 'active' : ''}">
                                    <div class="px-6 pb-4 pt-2 bg-gray-50">
                                        <div class="ml-16 space-y-4">
                                            ${q.steps && q.steps.map((step, stepIdx) => `
                                                <div class="border-l-4 border-indigo-300 pl-4">
                                                    <div class="flex items-start gap-3">
                                                        <span class="flex-shrink-0 w-7 h-7 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-semibold">
                                                            ${stepIdx + 1}
                                                        </span>
                                                        <div class="flex-1">
                                                            <p class="text-gray-700 whitespace-pre-line leading-relaxed">
                                                                ${step.text}
                                                            </p>
                                                            ${step.image && step.image.url ? `
                                                                <div class="mt-3 border border-gray-200 rounded-lg overflow-hidden bg-white">
                                                                    <img 
                                                                        src="${step.image.url}" 
                                                                        alt="${step.image.caption || `Step ${stepIdx + 1}`}"
                                                                        class="w-full h-auto"
                                                                        onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'200\\'%3E%3Crect fill=\\'%23f3f4f6\\' width=\\'400\\' height=\\'200\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' fill=\\'%239ca3af\\' font-family=\\'sans-serif\\' font-size=\\'14\\'%3EImage not available%3C/text%3E%3C/svg%3E'"
                                                                    />
                                                                    ${step.image.caption ? `
                                                                        <div class="px-4 py-2 bg-gray-50 text-sm text-gray-600 border-t border-gray-200">
                                                                            ${step.image.caption}
                                                                        </div>
                                                                    ` : ''}
                                                                </div>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', () => {
            loadFaqData();
            
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                renderFaqs(e.target.value);
            });
        });
    </script>
</body>
</html>